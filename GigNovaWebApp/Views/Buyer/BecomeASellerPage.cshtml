@model GigNovaModels.Models.Seller
@{
    ViewData["Title"] = "BecomeASellerPage";
    Layout = "~/Views/Shared/MasterBuyerPage.cshtml";
}

<link href="~/css/buyer_pages/becomeseller_page.css" rel="stylesheet" />

<div class="signup-container">
    <div class="signup-card">
        <h1 class="signup-title">Become A Seller</h1>
        <p class="signup-subtitle">Start offering your services and earn money on GigNova</p>

        @if (ViewBag.ErrorMessage != null)
        {
            <p class="text-danger">@ViewBag.ErrorMessage</p>
        }

        <form asp-controller="Buyer" asp-action="BecomeASeller" method="post" enctype="multipart/form-data" id="sellerForm">
            <div class="avatar-section">
                <div class="avatar-container">
                    <div class="avatar" id="avatarPreview">📸</div>
                </div>
                <label for="sellerAvatarFile" class="upload-avatar-btn">Upload Profile Picture</label>
                <input type="file" id="sellerAvatarFile" name="sellerAvatarFile" class="file-input" accept="image/*">
            </div>

            <div class="form-group">
                <label class="form-label" for="Seller_display_name">Seller Display Name</label>
                <input type="text"
                       id="Seller_display_name"
                       name="Seller_display_name"
                       class="form-input"
                       placeholder="Enter your seller display name"
                       value="@(Model != null ? Model.Seller_display_name : "")"
                       required>
            </div>

            <div class="form-group">
                <label class="form-label" for="Seller_description">Seller Bio</label>
                <textarea id="Seller_description"
                          name="Seller_description"
                          class="form-textarea"
                          placeholder="Tell potential clients about your skills, experience, and what services you offer..."
                          maxlength="500"
                          required>@(Model != null ? Model.Seller_description : "")</textarea>
                <div class="char-count"><span id="charCount">0</span>/500 characters</div>
            </div>

            <div class="form-group">
                <label class="form-label">Payment Account</label>
                <button type="button" class="link-account-btn" id="linkAccountBtn">
                    <span class="btn-icon">💳</span>
                    <span class="btn-text" id="linkButtonText">@(Model != null && Model.Seller_is_linked ? "Unlink Payment Account" : "Link Payment Account")</span>
                </button>
                <input asp-for="Seller_is_linked" type="checkbox" id="Seller_is_linked" style="display:none;" />
                <p class="account-status" id="accountStatus">@(Model != null && Model.Seller_is_linked ? "Payment account linked" : "No payment account linked")</p>
            </div>

            <label class="checkbox-group">
                <input type="checkbox" id="ageConfirm" name="ageConfirm" required>
                <span class="checkbox-label">I confirm that I am 18 years of age or older and agree to GigNova's seller terms and conditions.</span>
            </label>

            <button type="submit" class="submit-btn" id="submitBtn">Start Selling</button>

            <div class="info-text">
                By becoming a seller, you'll be able to create gigs, receive orders, and earn money on the platform.
            </div>
        </form>
    </div>
</div>

<script>
    (function () {
        var bio = document.getElementById('Seller_description');
        var count = document.getElementById('charCount');
        if (bio && count) {
            var updateCount = function () { count.textContent = bio.value.length; };
            bio.addEventListener('input', updateCount);
            updateCount();
        }

        var avatarInput = document.getElementById('sellerAvatarFile');
        var preview = document.getElementById('avatarPreview');
        if (avatarInput && preview) {
            avatarInput.addEventListener('change', function () {
                if (!avatarInput.files || avatarInput.files.length === 0) {
                    preview.textContent = '📸';
                    preview.style.backgroundImage = '';
                    return;
                }

                var file = avatarInput.files[0];
                var reader = new FileReader();
                reader.onload = function (e) {
                    preview.textContent = '';
                    preview.style.backgroundImage = 'url(' + e.target.result + ')';
                    preview.style.backgroundSize = 'cover';
                    preview.style.backgroundPosition = 'center';
                };
                reader.readAsDataURL(file);
            });
        }

        var linkedCheckbox = document.getElementById('Seller_is_linked');
        var linkButton = document.getElementById('linkAccountBtn');
        var linkButtonText = document.getElementById('linkButtonText');
        var accountStatus = document.getElementById('accountStatus');

        var renderPaymentState = function () {
            if (!linkedCheckbox || !linkButtonText || !accountStatus) {
                return;
            }

            if (linkedCheckbox.checked) {
                linkButtonText.textContent = 'Unlink Payment Account';
                accountStatus.textContent = 'Payment account linked';
            } else {
                linkButtonText.textContent = 'Link Payment Account';
                accountStatus.textContent = 'No payment account linked';
            }
        };

        if (linkButton && linkedCheckbox) {
            linkButton.addEventListener('click', function () {
                linkedCheckbox.checked = !linkedCheckbox.checked;
                renderPaymentState();
            });
            renderPaymentState();
        }
    })();
</script>
